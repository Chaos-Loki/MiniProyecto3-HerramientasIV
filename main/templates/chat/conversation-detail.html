<!-- conversation_detail.html -->
<h1>{{conversation.room_name}}</h1>

<h2>{{conversation.user1.user.username}} - {{conversation.user2.user.username}}</h2>

<div id="messages">
{% for message in messages %}
    <p>{{message.from_user.user.username}}: {{message.content}}</p>
{% endfor %}
</div>

<form method="POST">
    {% csrf_token %}
    {{ form.as_p  }}
    <input type="submit" value="Send"> 
</form>

<script>
    var socket = new WebSocket('ws://' + window.location.host + '/ws/conversation/{{ conversation.id }}/');
    
    socket.onmessage = function(event) {
        var data = JSON.parse(event.data);
        $('#messages').append('<p>' + data.content + '</p>');
    };
    
    $('form').submit(function(event) {
        event.preventDefault();
        var message = $('#id_content').val(); 
        socket.send(JSON.stringify({
            'content': message
        }));
        $('#id_content').val('');
    });
</script>
